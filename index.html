<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Alpha Notes - Dev Bandhiya</title>

<style>
/* ===== SAME CSS AS BEFORE (UNCHANGED) ===== */
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  line-height: 1.6;
  color: #333;
  background: #f4f4f4;
}
header {
  background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
  color: white;
  padding: 1rem 0;
}
nav {
  max-width: 1200px;
  margin: auto;
  padding: 0 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.logo { font-size: 1.5rem; font-weight: bold; }
.nav-links { list-style: none; display: flex; gap: 2rem; }
.nav-links a { color: white; cursor: pointer; text-decoration: none; }
.container { max-width: 1200px; margin: 2rem auto; padding: 0 20px; }
.page { display: none; }
.page.active { display: block; }
</style>

<!-- ✅ Load Supabase safely -->
<script src="https://unpkg.com/@supabase/supabase-js@2" defer></script>
</head>

<body>

<header>
  <nav>
    <div class="logo">Alpha Notes</div>
    <ul class="nav-links">
      <li><a onclick="showPage('about')">About</a></li>
      <li><a onclick="showPage('blog')">Blog</a></li>
      <li><a onclick="showPage('contact')">Contact</a></li>
    </ul>
  </nav>
</header>

<div class="container">

  <div id="about" class="page active">
    <h1>About</h1>
    <p>Welcome to Alpha Notes.</p>
  </div>

  <div id="blog" class="page">
    <h1>Blog</h1>
    <div onclick="showBlogPost('post1')" style="cursor:pointer">Open Post 1</div>
  </div>

  <div id="post1" class="page">
    <a onclick="showPage('blog')" style="cursor:pointer">← Back</a>
    <h1>Post 1</h1>
    <form onsubmit="addComment(event, 'post1')">
      <input id="name1" placeholder="Name" required />
      <textarea id="comment1" placeholder="Comment" required></textarea>
      <button type="submit">Post</button>
    </form>
    <div id="comments-post1"></div>
  </div>

  <div id="contact" class="page">
    <h1>Contact</h1>
  </div>

</div>

<script>
/* =============================
   GLOBAL NAVIGATION (SAFE)
============================= */
window.showPage = function(pageId) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  const page = document.getElementById(pageId);
  if (!page) return;
  page.classList.add('active');
};

/* =============================
   BLOG NAVIGATION
============================= */
window.showBlogPost = function(postId) {
  showPage(postId);
  loadComments(postId);
};

/* =============================
   SUPABASE INIT (GUARDED)
============================= */
const SUPABASE_URL = "https://uzatsvxrjrnqsupeokvq.supabase.co";
const SUPABASE_ANON_KEY = "YOUR_KEY_HERE";

let supabase = null;

window.addEventListener("DOMContentLoaded", () => {
  if (!window.supabase) {
    console.warn("Supabase not loaded – comments disabled");
    return;
  }
  supabase = window.supabase.createClient(
    SUPABASE_URL,
    SUPABASE_ANON_KEY
  );
});

/* =============================
   COMMENTS (SAFE)
============================= */
async function loadComments(postId) {
  if (!supabase) return;

  const { data } = await supabase
    .from("comments")
    .select("*")
    .eq("post_id", postId)
    .order("created_at");

  const el = document.getElementById("comments-" + postId);
  if (!el) return;
  el.innerHTML = data.map(c => `<p><b>${c.name}</b>: ${c.text}</p>`).join("");
}

async function addComment(e, postId) {
  e.preventDefault();
  if (!supabase) return;

  const name = document.getElementById("name1").value;
  const text = document.getElementById("comment1").value;

  await supabase.from("comments").insert([{ post_id: postId, name, text }]);
  loadComments(postId);
}
</script>

</body>
</html>
